# hackathon2022

Для хранения полученных данных со смартфона используем MySQL, ибо хранить всё в .txt не по феншую

Базу данных злоумышленника развернем в контейнере для удобства

**Для импорта контейнера:**
=
```
docker load -i mysql_hack.tar
```
**Docker-compose**
=
> Чтобы упростить процедуру развертывания контейнеров, сделал docker-compose файл, поднимет сервер злоумышленника, который ждет файлы и базу данных в двух контейнерах

> Перед этим создаем сеть, как указано в гайде "Для создания контейнера"
```
cd docker_images
docker-compose build
docker-compose up
```

> После этого останется только создать таблицу (см гайд "Для создания контейнера")
```
use hacker_db;
CREATE TABLE target_phone (name VARCHAR(20), number VARCHAR(11));
```

**Для создания контейнера:**
=
> Создаем сеть для взаимодействия с контейнером
```
docker network create intruder_net
```
> Загружаем image с установленным mysql, пробрасываем порт 3306, для взаимодействия с нашей машиной.
> Указываем нашу сетку intruder_net.
> Создаем БД hacker_db в контейнере.
```
docker run --name=mysql -p 3306:3306 --network=intruder_net  -e MYSQL_ROOT_HOST=%
-e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=hacker_db -d mysql:latest
```
> Чтобы зайти в контейнер делаем docker ps, копируем DOCKER ID
```
docker ps
CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                               NAMES
9e6f50f6d3c9   mysql:latest   "docker-entrypoint.s…"   4 minutes ago   Up 4 minutes   0.0.0.0:3306->3306/tcp, 33060/tcp   mysql
```
> Чтобы войти в контейнер по ID (Если идете просто по гайду, то заходить в контейнер не нужно, подключимся из нашей системы сразу к MySQL)
```
docker exec -ti 9e6f50f6d3c9 /bin/bash
```
> Скачиваем клиент mysql, если такового не имеется, ссылка для шиндовс:
`https://dev.mysql.com/downloads/mysql/`

>Разархивируем куда-нибудь и прописываем путь к папке bin в PATH
```
set PATH=%PATH%;"C:\mysql-8.0.31-winx64\bin"
```
>Подключаемся к MySQL
```
mysql -h localhost -u root -p
```
> Создаем таблицу target_phone с полями name и number
```
use hacker_db;
CREATE TABLE target_phone (name VARCHAR(20), number VARCHAR(11));
```
> Вставляем тестовую запись в БД
```
INSERT INTO target_phone (name, number) VALUES ('Test', '79139445566');
```
> Проверяем
```
SELECT * FROM target_phone;

Ожидаемый вывод:
+------+-------------+
| name | number      |
+------+-------------+
| Test | 79139445566 |
+------+-------------+
1 row in set (0.00 sec)
```
> Всё ок, теперь можно из скрипта делать записи в БД

**Как поднять сервер злоумышленника**
=
> Переходим в директорию с docker-compose.yml и делаем build
```
docker-compose build
```
> Когда всё успешно забилдилось  делаем
```
docker-compose up
```
> У нас успешно поднялся контейнер, в котором запущен скрипт server.py (он всё также будет писать данные в БД, развернутой в первом контейнере)

Android:
=
>Нашел репо со всем что нужно для симуляции андроида в докере
https://github.com/budtmo/docker-android/blob/master/README.md

> Пока не понял как законнектить его к docker сети, в которой сидят остальные сервисы. Мб пробросить еще один порт на хост тачку и общаться через нее, но думаю это не очень правильно (но для начала как вариант)

> --network intruder_net в docker run приводит к ошибкам работы, скорее всего должен быть другой вариант

>Командочка из репо выше, поднимет контейнер с андроид 11.0 на девайсе Samsung Galaxy S6, список устройств есть в репо
docker run --privileged -d -p 6080:6080 -p 5554:5554 -p 5555:5555 -e DEVICE="Samsung Galaxy S6" -c 614 --network=intruder_net --name android-container budtmo/docker-android-x86-11.0
> -c 614 выделяет для контейнера 60% ресурсов ПК, после первого запуска понял что штука тяжелая, поэтому выделил столько (про это можно подробнее посмотреть, не сильно шарю)

> После старта контейнера переходим на
> http://localhost:6080/

>Видим наш андроид девайс

Жрет оно прилично, на слабых пекарнях даже не пытайтесь запускать!

> У меня ушло примерно 5 минут чтобы просто прогрузить главное меню смартфона, работает не оч стабильно

> Со скрипом, но главное работает, однако что-то делать будет тяжко

> Можно поэкспериментировать с разными девайсами, либо поискать еще вариантов виртуализации андроида в докере, хотя можно к докеру сильно не привязываться

> Шел второй час возьни с виртуалкой ведройда в виртуалке...

> Забавная штука, но для наших целей не подойдет. Ставлю android studio
https://developer.android.com/studio

> Вот тут можно посмотреть как поставить android 11
https://www.youtube.com/watch?v=RaR24h_06oE

> Ставим adb
https://adbinstaller.com/

> Бридж для дебага, даст доступ в shell android виртуалки

> Разархивировать и запускать из этой директории (лучше добавить путь до папки в path), тогда запустится откуда угодно